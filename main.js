(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-25",headers:{authorization:"fdd7000f-822a-4754-b25a-f3d99797b450","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Произошла ошибка: ".concat(e.status))}function n(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then(t)}function o(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then(t)}function r(e){e.classList.add("popup_is-animated"),e.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function a(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))}function i(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent="",t.setCustomValidity("")}function u(e,t){var n=t.inputSelector,o=t.inputErrorClass,r=t.errorClass;Array.from(e.querySelectorAll(n)).forEach((function(t){i(e,t,o,r)}))}var s,l,d,p,f,m=document.querySelector(".places__list"),_=document.querySelector(".profile__add-button"),h=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_image"),y=document.querySelector(".popup__image"),S=document.querySelector(".popup__caption"),b=document.querySelector(".popup_type_new-card"),E=document.querySelector(".popup_type_edit"),k=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),L=document.querySelector(".profile__image"),C=document.querySelector(".popup_type_edit-avatar"),g=document.querySelector(".profile__avatar-button"),x=document.querySelectorAll(".popup"),A=document.querySelectorAll(".popup__close"),U=document.forms["image-profile"],w=U.elements.avatar,T=document.forms["edit-profile"],P=T.elements.name,B=T.elements.description,D=document.forms["new-place"],N=D.elements["new-place-name"],j=D.elements["new-place-link"],I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function M(e,t,n){m.prepend(function(e,t,n,o,r,c){var a=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__image"),u=a.querySelector(".card__title"),s=a.querySelector(".card__delete-button"),l=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-counter"),p=e._id,f=e.owner._id;return i.src=e.link,i.alt=e.name,u.textContent=e.name,d.textContent=e.likes.length,e.likes.some((function(e){return e._id===c}))&&l.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(){undefined(p,l,d)})),f!==c?s.remove():s.addEventListener("click",(function(){t(p,a)})),i.addEventListener("click",(function(){return undefined(e)})),a}(e,t))}l=(s=I).formSelector,d=s.inputSelector,p=s.submitButtonSelector,f=s.inactiveButtonClass,Array.from(document.querySelectorAll(l)).forEach((function(e){!function(e,t,n,o){Array.from(e.querySelectorAll(t)).forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?i(e,t,n,o):(t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o))}(e,t,n,o)}))}))}(e,d,p,f)}));var O={openFullImagePopup:function(e,t){y.src=e,y.alt=t,S.textContent=t,r(v)},likeCard:function(e,t,r){(r.classList.contains("card__like-button_is-active")?o:n)(e).then((function(e){r.classList.toggle("card__like-button_is-active"),t.textContent=e.likes.length}))},deleteCard:function(n,o){(function(n){return fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))})(n).then((function(){o.remove()})).catch((function(e){console.error("Ошибка при удалении карточки:",e)}))}};Promise.all([fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t),fetch("".concat(e.baseUrl,"/users/me"),{method:"GET",headers:e.headers}).then((function(e){return t(e)})).catch((function(e){console.error("Ошибка загрузки данных пользователя:",e)}))]).then((function(e,t){k.textContent=e[1].name,q.textContent=e[1].about,L.style.backgroundImage="url(".concat(e[1].avatar,")"),e._id,t.forEach((function(e){M(e,O)}))})).catch((function(e){console.log("Не могу понять где ошибка ".concat(e))})),_.addEventListener("click",(function(){u(D,I),D.reset(),r(b)})),h.addEventListener("click",(function(){P.value=k.textContent,B.value=q.textContent,u(T,I),r(E)})),L.addEventListener("click",(function(){u(U,I),U.reset(),r(C)})),A.forEach((function(e){e.addEventListener("click",(function(){c(e.parentNode.parentNode)}))})),x.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&!t.target.classList.contains("popup__content")&&c(e)}))}));var V=function(e,t){t.textContent=e?"Сохранение...":"Сохранить"};T.addEventListener("submit",(function(e){e.preventDefault(),k.textContent=P.value,q.textContent=B.value,V(!0,popupButtonEdit),c(E)})),D.addEventListener("submit",(function(n){var o;n.preventDefault(),(o={name:N.value,link:j.value},fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:o,link:undefined})}).then(t)).then((function(e){M(e,O),D.reset(),c(b)})).catch((function(e){console.log("Ошибка при добавлении новой карточки:",e)}))})),U.addEventListener("submit",(function(n){var o;n.preventDefault(),V(!0,g),(o=w.value,fetch("".concat(e.baseUrl,"/users/me/avatar "),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then((function(e){return t(e)})).catch((function(e){console.error("Не удалось обновить фото профиля:",e)}))).then((function(e){L.style.backgroundImage="url(".concat(e.avatar,")"),U.reset(),c(C)})).catch((function(e){console.log("Ошибка при обновлении аватара:",e)}))}))})();